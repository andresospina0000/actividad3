<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="assets/css/bootstrap.css">
    <link rel="stylesheet" href="./assets/css/index.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@200;400&display=swap" rel="stylesheet">
    <title>Team 8's - Clothing Store</title>
</head>

<header>
    <div>
        <nav class="navbar nav-tabs fixed-top navbarfa-pull-right bg-light" style="background-color: bg-primary">
            <a class="nav-link" onclick="updateHomeProducts()">Home</a>
            <a class="nav-link" onclick="showPrdCreationPanel()">Create new products!</a>
            <a class="nav-link" onclick="">Update your products!</a>
            <a class="nav-link" onclick="alert('About us!')">About us</a>
        </nav>
    </div>
    <div class="container">
        <h1>Welcome to Team 8's</h1>
        <h6>Clothing Store</h6>
    </div>
</header>
<br>

<body class="">
    <div class="container">
        <div id="productsTitle" class="container">
            <h3>Our products</h3>
        </div>
        <div id="productsPanel"></div>
    </div>
    <br>
    <div id="creationPanel" class="container" hidden="true">
        <div class="container">
            <h3>Create New Product</h3>
        </div>
        <div>
            <div id="newPrdForm" class="container">
                <div class="input-group mb-3">
                    <span class="input-group-text" id="basic-addon1">Product Title</span>
                    <input id="newPrdTitle" type="text" class="form-control" placeholder="Product Title"
                        aria-label="Username" aria-describedby="basic-addon1">
                </div>
                <div class="input-group mb-3">
                    <span class="input-group-text">Product price $</span>
                    <input id="newPrdPrice" type="text" class="form-control"
                        aria-label="Amount (to the nearest dollar)">
                    <span class="input-group-text">.00</span>
                </div>
                <div class="input-group">
                    <span class="input-group-text">Product description</span>
                    <textarea id="newPrdDesc" class="form-control" aria-label="With textarea"></textarea>
                </div>
                <div class="mb-3">
                    <label for="formFile" class="form-label">Please choose an image for your product:</label>
                    <input id="newPrdImage" class="form-control" type="file" id="formFile">
                </div>
                <div class="row">
                    <div class="col">
                        <button onclick="previewProduct()" class="btn btn-primary">Product preview...</button>
                    </div>
                    <div class="col">
                        <button onclick="createProduct()" class="btn btn-primary">Create Product</button>
                    </div>
                </div>
            </div>
            <br>
            <div id="newPrdPanelPreview" hidden="true">
                <div>
                    <h6>This is how your product will look:</h6>
                </div>
                <div class="card" style="width: 18rem;">
                    <img src="assets/img/sample.jpg" class="card-img-top" alt="...">
                    <div class="card-body">
                        <h5 id="previewPrdName" class="card-title">Product Name</h5>
                        <h5 id="previewPrdPrice" class="card-title">Product Price</h6>
                            <p id="previewDesc" class="card-text">Some quick example text to build on the card title and
                                make up the bulk of
                                the
                                card's content.</p>
                            <a href="#" class="btn btn-primary">Buy</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="managmentPanel" class="container">

    </div>
</body>

</html>

<script>

    updateHomeProducts()

    //API Integration
    async function getAllProducts() {
        const response = await fetch('http://localhost:4000/api/products');
        const data = await response.json();
        return data;
    }

    async function createProduct() {

        const newProduct = getNewProduct();

        if (newProduct) {

            const response = await fetch('http://localhost:4000/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(newProduct)
            });

            const data = await response.json();

            if (data.error) {
                alert(data.error);
                return;
            } else {
                new Promise((resolve, reject) => {
                    setTimeout(() => resolve(alert('Product created successfully!')), 10000)
                });
            }
        }
    }

    //API Integration

    //DOM Manipulation
    function showPrdCreationPanel() {
        document.getElementById('productsPanel').hidden = true;
        document.getElementById('productsTitle').hidden = true;
        document.getElementById('creationPanel').hidden = false;
        document.getElementById('newPrdTitle').value = '';
        document.getElementById('newPrdPrice').value = '';
        document.getElementById('newPrdDesc').value = '';
        document.getElementById('newPrdImage').value = '';
        cleanPreviewPanel();
    }

    function cleanCreationPanel() {
        document.getElementById('newPrdTitle').value = '';
        document.getElementById('newPrdPrice').value = '';
        document.getElementById('newPrdDesc').value = '';
        document.getElementById('newPrdImage').value = '';
    }

    function showProducts() {
        document.getElementById('productsPanel').hidden = false;
        document.getElementById('productsTitle').hidden = false;
        document.getElementById('creationPanel').hidden = true;
    }

    async function updateHomeProducts() {

        showProducts();
        let cards = '';
        const productsPanel = document.getElementById('productsPanel');
        productsPanel.innerHTML = '';

        const products = await getAllProducts();

        products.forEach(element => {

            cards = `<div class="p-2 card" style="width: 18rem;">
                        <img src="${element.image}" class="card-img-top">
                        <div class="card-body">
                            <h5 class="card-title">${element.title}</h5>
                            <h6>$${element.price}</h6>
                            <p class="card-text">${element.description}</p>
                            <a href="#" class="btn btn-primary">Add to cart</a>
                        </div>
                    </div>`;
            productsPanel.insertAdjacentHTML("afterbegin", cards);
        });
    }

    function getNewProduct() {
        const newPrdTitle = document.getElementById('newPrdTitle').value;
        const newPrdPrice = document.getElementById('newPrdPrice').value;
        const newPrdDesc = document.getElementById('newPrdDesc').value;
        const imagePath = document.getElementById('newPrdImage').value + '';
        const splittedPath = imagePath.split('\\');
        const newPrdImage = `assets/img/${splittedPath[splittedPath.length - 1]}`;

        if (!newPrdTitle || !newPrdDesc || !newPrdPrice || !newPrdImage) {
            alert('You must complete all the form! :(')
            return null;
        }

        const newPrd = {
            title: newPrdTitle,
            price: newPrdPrice,
            description: newPrdDesc,
            image: newPrdImage
        }

        return newPrd;
    }

    function previewProduct() {
        const newPrd = getNewProduct();
        if (newPrd) {
            document.getElementById('newPrdPanelPreview').hidden = false;
            document.getElementById('previewPrdName').innerHTML = newPrd.title;
            document.getElementById('previewPrdPrice').innerHTML = `$${newPrd.price}`;
            document.getElementById('previewDesc').innerHTML = newPrd.description;
        }
    }

    function cleanPreviewPanel() {
        document.getElementById('newPrdPanelPreview').hidden = true;
        document.getElementById('previewPrdName').innerHTML = '';
        document.getElementById('previewPrdPrice').innerHTML = '';
        document.getElementById('previewDesc').innerHTML = '';
    }
    //DOM Manipulation

</script>